generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("POSTGRES_PRISMA_URL")
  directUrl = env("POSTGRES_URL_NON_POOLING")
}

// --------------------------------------
// NIEUWE MODELLEN
// --------------------------------------

// Je partners (AdCombo, ClickDealer, etc.)
model AffiliateNetwork {
  id            Int      @id @default(autoincrement())
  name          String   @unique 
  
  offers        Offer[]
  // CORRECTIE: Verwijst nu naar Adjustment (was RevenueAdjustment)
  adjustments   Adjustment[] 

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt
}

// Campagnes / Projecten
model Campaign {
  id          Int          @id @default(autoincrement())
  name        String
  
  type        String       @default("PAID") 
  currency    String       @default("USD")
  logo        String?      @default("") 

  offers      Offer[]
  dailySpends DailySpend[]
  
  // Deze stond al goed
  adjustments Adjustment[]
  
  logs        DailyLog[]
  members     CampaignMember[]

  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

model User {
  id        Int      @id @default(autoincrement())
  email     String   @unique
  password  String   
  name      String?
  role      String   @default("USER") 
  
  memberships CampaignMember[]
}

// Handmatige inkomsten (Bonussen, RevShare correcties, SEO maandbedragen)
model Adjustment {
  id            Int      @id @default(autoincrement())
  date          DateTime
  amount        Float
  currency      String   @default("USD")
  description   String?
  type          String
  // AANPASSINGEN:
  exchangeRate  Float    @default(1.0)   // <--- NIEUW: Omrekenfactor naar USD

  // CORRECTIE: Netwerk optioneel gemaakt (Int?), want finance tool gebruikt dit niet altijd
  networkId     Int?
  network       AffiliateNetwork? @relation(fields: [networkId], references: [id])
  
  // CORRECTIE: Campaign verplicht gemaakt (Int), want een finance item hoort bij een project
  campaignId    Int
  campaign      Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  offerId       Int?
  offer         Offer?   @relation(fields: [offerId], references: [id])

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  // Indexen voor snelheid
  @@index([campaignId])
  @@index([date])
}

// --------------------------------------
// AANGEPASTE BESTAANDE MODELLEN
// --------------------------------------

model DailySpend {
  id           Int      @id @default(autoincrement())
  date         DateTime
  platform     String   
  
  amount       Float    
  currency     String   @default("EUR") 
  exchangeRate Float    @default(1.0) 

  campaignId   Int?
  campaign     Campaign? @relation(fields: [campaignId], references: [id])

  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@unique([date, platform, campaignId], name: "date_platform_campaign")
  @@index([date])
  @@index([campaignId])
}

model Offer {
  id            Int          @id @default(autoincrement())
  name          String

  networkLegacy String?      @map("network")

  networkId     Int?
  network       AffiliateNetwork? @relation(fields: [networkId], references: [id])
  
  status        String       @default("ACTIVE") 
  
  payoutLead    Float        @default(0)
  payoutSale    Float        @default(0)

  capLeads      Int?
  capRevenue    Float?

  campaignId    Int?
  campaign      Campaign?    @relation(fields: [campaignId], references: [id])

  conversions   Conversion[]
  
  // CORRECTIE: Verwijst nu naar Adjustment (was RevenueAdjustment)
  adjustments   Adjustment[]
  
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt

  @@index([campaignId])
}

model Conversion {
  id        Int      @id @default(autoincrement())
  date      DateTime
  
  offerId   Int
  offer     Offer    @relation(fields: [offerId], references: [id], onDelete: Cascade)
  
  leads     Int      @default(0)
  sales     Int      @default(0)
  
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  // Dit is voor je import script (om dubbele te voorkomen)
  externalId String?   @unique 

  @@unique([date, offerId], name: "date_offerId")
  @@index([date])
  @@index([offerId])
}

model DailyLog {
  id          Int      @id @default(autoincrement())
  date        DateTime
  type        String   
  data        String   
  
  campaignId  Int
  campaign    Campaign @relation(fields: [campaignId], references: [id])

  createdAt   DateTime @default(now())
}

model CampaignMember {
  id          Int      @id @default(autoincrement())
  role        String   @default("MEMBER") 
  
  userId      Int
  user        User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  campaignId  Int
  campaign    Campaign @relation(fields: [campaignId], references: [id], onDelete: Cascade)

  @@unique([userId, campaignId]) 
}